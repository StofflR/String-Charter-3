<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>String Charter 3</title>
    <link href="/src/styles.css" rel="stylesheet">
</head>

<body>
<script src="https://cdn.tailwindcss.com"></script>

<header class="header flex flex-col items-center justify-center text-center my-8">
    <h1 class="text-4xl md:text-6xl font-extrabold text-gray-700 drop-shadow-lg tracking-tight mb-2">
        String Charter 3
    </h1>
    <p class="text-lg md:text-2xl text-gray-600 font-medium">
        Visualize GTFS data as a string graph.
    </p>
</header>
<label for="drop-area">Select a GTFS zip</label>

<div id="drop-area"
     class="border-2 border-dashed border-gray-400 rounded-lg p-8 text-center cursor-pointer transition hover:bg-gray-100">
    <p class="mb-2">Drag & drop a GTFS zip file here, or <span class="text-blue-600 underline">click to select</span>
    </p>
    <input type="file" id="file-input" accept=".zip" class="hidden"/>
</div>

<div class="mt-2 text-gray-700" id="file-name-label"></div>

<script>
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('file-input');
    const fileNameLabel = document.getElementById('file-name-label');
    const exportButton = document.getElementById('exportButton');
    const flipAxis = document.getElementById('axis-switch');

    dropArea.addEventListener('click', () => fileInput.click());

    dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('bg-gray-200');
    });

    dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('bg-gray-200');
    });

    dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.classList.remove('bg-gray-200');
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            // Handle the file as needed
        }
    });

    fileInput.addEventListener('change', () => {
        exportButton.hidden = fileInput.files.length === 0;
        flipAxis.hidden = fileInput.files.length === 0;

        if (fileInput.files.length) {
            fileNameLabel.textContent = `Selected file: ${fileInput.files[0].name}`;
        }
    });
</script>

<div class="card mx-8" id="ui-card">
    <br>
    <label for="route-select" class="">Select a route:</label>
    <div class="relative w-64 mx-auto my-4">
        <select id="route-select"
                class="block w-full appearance-none bg-white border border-gray-300 text-gray-700 py-3 px-4 pr-10 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition">
            <!-- options go here -->
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
            </svg>
        </div>
    </div>
</div>

<div class="flex items-center justify-center my-4" id="flip-axis">
    <label for="axis-switch" class="flex items-center cursor-pointer">
        <span class="mr-3 text-gray-700 font-medium">Flip Axis</span>
        <div class="relative">
            <input id="axis-switch" type="checkbox" class="sr-only peer" hidden>
            <div class="w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-blue-500 transition"></div>
            <div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow peer-checked:translate-x-5 transition"></div>
        </div>
    </label>
</div>

<div class="card" id="string-graph-card">
    <div id="stop-detail"></div>
    <canvas id="graphCanvas" width="1200" height="600"></canvas>

</div>
<div class="flex justify-center">
    <button id="exportButton"
            class="mt-6 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-700 text-white font-semibold rounded-full shadow-md transition transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
            hidden>
        Export as SVG
    </button>
</div>
<script type="module" src="/src/main.ts" defer></script>
<script type="module" src="/src/load_gtfs_data.ts" defer></script>
<script type="module" src="/src/string_graph.ts" defer></script>
</body>

</html>